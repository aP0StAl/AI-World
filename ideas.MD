# ideas.md

## 1. Глобальное состояние мира и долговременная память
* **world_state.json** хранит:
  * общие факты (погода, новости, слухи, экономика);
  * личные переменные каждого персонажа (финансы, отношения, здоровье, репутация).
* При каждом ходе:
  1. В prompt персонажа добавляется релевантный срез `world_state`.
  2. После ответа LLM-функция извлекает новые факты и обновляет `world_state`.
* Итог: решения героев оставляют долгосрочный след, история становится последовательной.

## 2. Скрытые цели и динамические квесты
* У каждого героя появляется блок `goal`:
```json
  "goal": {
    "current": "найти редкую рукопись",
    "progress": 0.4,
    "deadline": "2030-05-01"
  }
```

* В system-prompt добавляется указание продвигать цель при возможности.
* Триггеры (события, прогресс) могут менять цель или порождать новые задачи.

## 3. Движок внешних событий

* Раз в *N* ходов генерируется «карточка события» — JSON или реплика `SYSTEM-EVENT`.

  * Примеры: отключение света, фестиваль, пожар, политический скандал.
* Персонажи видят событие в истории и реагируют согласно характеру и целям.
* Внешние повороты придают сюжету непредсказуемость и масштаб.

## 4. Пост-обработка и свёртка сюжетных дуг

* После каждого хода LLM-функция `summarize_delta` кратко фиксирует «что изменилось».
* Если цепочка сообщений превышает *M* записей, старые реплики сворачиваются в абзац-резюме.
* Экономит токены и одновременно удерживает контекст длительной истории.

## 5. Рейтинговая селекция вариантов ответа

* Для каждого хода генерируются *k* вариантов (`n=4`, `temperature≈1.0`).
* Вторая модель-оценщик или эвристика ранжирует по критериям:

  * соответствие памяти мира;
  * продвижение целей;
  * эмоциональная выразительность / разнообразие.
* Лучший вариант публикуется в чат, остальные отбрасываются.
